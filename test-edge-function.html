<!DOCTYPE html>
<html>
<head>
    <title>Test Edge Function</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-form { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .result { background: #e8f5e8; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffe8e8; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ Edge Function Tester</h1>
    
    <div class="test-form">
        <h3>Send Test Message</h3>
        <div>
            <label>Zones (comma-separated): </label>
            <input type="text" id="zones" value="1,3" placeholder="1,2,3,4">
        </div>
        <div>
            <label>Message: </label>
            <input type="text" id="message" value="Test Message" placeholder="Your message">
        </div>
        <div>
            <label>Duration (seconds): </label>
            <input type="number" id="duration" value="8" min="1" max="300">
        </div>
        <div>
            <label>Animation: </label>
            <select id="animation">
                <option value="fade">Fade</option>
                <option value="slide">Slide</option>
                <option value="scroll">Scroll</option>
                <option value="none">None</option>
            </select>
        </div>
        <button onclick="sendMessage()">Send Message</button>
    </div>

    <div id="results"></div>

    <script>
        const EDGE_FUNCTION_URL = "https://gpcfhhwasgnzvhnnaogq.supabase.co/functions/v1/display"
        
        async function sendMessage() {
            const zones = document.getElementById('zones').value
            const message = document.getElementById('message').value
            const duration = document.getElementById('duration').value
            const animation = document.getElementById('animation').value
            
            const params = `Zone=${zones}&Msg=${encodeURIComponent(message)}&Duration=${duration}&Anim=${animation}`
            const url = `${EDGE_FUNCTION_URL}?${params}`
            
            console.log('Sending POST to:', url)
            
            try {
                const response = await fetch(url, { method: 'POST' })
                const result = await response.json()
                
                displayResult(result, response.ok, params)
            } catch (error) {
                displayResult({ error: error.message }, false, params)
            }
        }
        
        function displayResult(result, success, params) {
            const resultsDiv = document.getElementById('results')
            const resultDiv = document.createElement('div')
            resultDiv.className = `result ${success ? '' : 'error'}`
            
            resultDiv.innerHTML = `
                <h4>${success ? '‚úÖ Success' : '‚ùå Error'}</h4>
                <p><strong>Request:</strong> ${params}</p>
                <p><strong>Response:</strong></p>
                <pre>${JSON.stringify(result, null, 2)}</pre>
                <small>${new Date().toLocaleTimeString()}</small>
            `
            
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild)
        }
        
        // Quick test buttons
        document.addEventListener('DOMContentLoaded', () => {
            const quickTests = [
                { name: 'Single Zone', zones: '2', msg: 'Single Test', duration: 5, anim: 'fade' },
                { name: 'Multi Zone', zones: '1,3,4', msg: 'Multi Test', duration: 10, anim: 'scroll' },
                { name: 'Invalid Zone', zones: '5', msg: 'Should Fail', duration: 5, anim: 'fade' }
            ]
            
            const buttonsDiv = document.createElement('div')
            buttonsDiv.innerHTML = '<h3>Quick Tests:</h3>'
            
            quickTests.forEach(test => {
                const btn = document.createElement('button')
                btn.textContent = test.name
                btn.style.margin = '5px'
                btn.onclick = () => {
                    document.getElementById('zones').value = test.zones
                    document.getElementById('message').value = test.msg
                    document.getElementById('duration').value = test.duration
                    document.getElementById('animation').value = test.anim
                    sendMessage()
                }
                buttonsDiv.appendChild(btn)
            })
            
            document.body.insertBefore(buttonsDiv, document.getElementById('results'))
        })
    </script>
</body>
</html>